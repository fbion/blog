<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='A few notes taken when reading 

'>

<meta property='og:title' content='Concurrency in Go, Reading Notes ‚Ä¢ Shining Moon'>
<meta property='og:description' content='A few notes taken when reading 

'>
<meta property='og:url' content='https://blog.monsterxx03.com/2017/04/19/concurrency-in-go-reading-notes/'>
<meta property='og:site_name' content='Shining Moon'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='book'><meta property='article:tag' content='golang'><meta property='article:published_time' content='2017-04-19T16:26:58Z'/><meta property='article:modified_time' content='2017-04-19T16:26:58Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.29" />

  <title>Concurrency in Go, Reading Notes ‚Ä¢ Shining Moon</title>
  <link rel='canonical' href='https://blog.monsterxx03.com/2017/04/19/concurrency-in-go-reading-notes/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Ubuntu:400,400i,700&subset=latin'>
<link rel='stylesheet' href='/assets/css/main.77da63e1.css'><link rel='stylesheet' href='/css/custom.css'>
</head>


<body class='page type-post'>
  <div class='site'>

    <a class='screen-reader' href='#main'>Skip to Content</a>

    <header id='header' class='header-container'>
      <div class='header site-header'>
        <nav id='main-menu' class='main-menu-container' aria-label='Main Menu'>
  <ul class='main-menu'>
  <li>
      <a href='/'>HOME</a>
    </li>
  <li>
      <a href='/categories/tech/'>Tech</a>
    </li>
  <li>
      <a href='/categories/life/'>Life</a>
    </li>
  
  </ul>
</nav>

        <div class='header-info'>
          
          <p class='site-title title'>Shining Moon</p>
          
          <p class='site-description subtitle'>ÁôæÁßçÂºäÁóÖ,ÁöÜ‰ªéÊáíÁîü</p>
        </div>
      </div>
    </header>


<main id='main' class='main'>
  <article lang='en' class='entry'>
    <header class='header-container'>
  <div class='header entry-header'>
    <div class='header-info'>
      <h1 class='title'>Concurrency in Go, Reading Notes</h1>
      

    </div>
    
<div class='meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader'>Posted on </span>
  <time class='date' datetime='2017-04-19T16:26:58Z'>2017, Apr 19</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


</div>


  </div>
</header>

    
    

    <div class='entry-content'>
  <p>A few notes taken when reading <Concurrency in Go></p>

<p></p>

<h2 id="deadlock">Deadlock</h2>

<p>Coffman Conditions theory is used to help detect potential deadlock problem.</p>

<p>If your problem meet the following 4 conditions, it may come to deadlock.</p>

<ol>
<li>Mutual Exclusion: A concurrent process holds exclusive rights to a resource at any one time.</li>
<li>Wait for condition: A concurrent process must simultaneously hold a resource and be waiting for an additional resource</li>
<li>No Preemption: A resource held by a concurrent process can only be released by that process, so it fulfills this condition.</li>
<li>Circular Wait: A concurrent process must be waiting on a chain of other concurrent processes which are in turn waiting on it , so it fulfills this final condition too</li>
</ol>

<p>If we can avoid any one of these conditions, we can avoid deadlock, but in real world, its&#8217;s usually very hard</p>

<h2 id="livelock">Livelock</h2>

<p>Two processes try to avoid deadlock at same cadence, the result is no work is accomplished.</p>

<h2 id="starvation">Starvation</h2>

<p>Starvation is any situation where a concurrent process cannot get all the resources it needs to perform work.</p>

<p>Eg: two goroutines share a same lock, If one goroutine acquires the lock for too long time, another goroutine will be waiting too long, like it&#8217;s starving üôÅ</p>

<h2 id="concurrency-safety">Concurrency safety</h2>

<p>When you handling existing code, consider following question to determine whether it&#8217;s concurrency safey:</p>

<ol>
<li>Who is responsible for concurrency ?</li>
<li>How is the problem space mapped onto concurrency primitives? (how to divide the problem to make it run concurrently)</li>
<li>Who is response for synchronization ?</li>
</ol>

<h2 id="concurrency-and-parallelism">Concurrency and Parallelism</h2>

<p>Concurrency is about code, parallelism is about the state running program.</p>

<p>We write concurrent code to wish it can run in parallelly. (but if the running machine only have one core, the program will not be parallelism)</p>

<h2 id="lock-or-channel">Lock or Channel</h2>

<p><code>sync</code> package provide mutexes as well, how to choose it between channel?</p>

<p>If trying to transfer onwership of data, use channel.</p>

<p>If trying to guard internal state of a struct, use mutex.</p>

<p>Channel is more composable than lock.</p>

<h2 id="example">Example</h2>

<pre><code>func main() {
        var wg sync.WaitGroup
        for _, v := range []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;} {
                wg.Add(1)
                go func() {
                        defer wg.Done()
                        fmt.Println(v)
                }()
        }
        wg.Wait()
}
</code></pre>

<p>If the loop is very faster, the program will exit before goroutines start, the ouput will be three <code>c</code>.</p>

<p>If there is heavy logic in loop, result will be nondeterministic.</p>

<p>The right way is pass <code>v</code> to the closure to make a copy, then every goroutine will hold the exact value passed to it.</p>

<h2 id="misc">Misc</h2>

<p>A goroutine consume a few kilobytes ram.</p>

<p>System thread context switch will cost about 1 ~ 2 us per round(send message between threads).</p>

<p>Goroutine context switch cost about 200 ns per round (send message between goroutines), about 92% faster than os thread.</p>

<p>Use <code>sync.Cond</code>, if you need to suspend a goroutine.</p>
</div>

    
<footer class='entry-footer-container'>
  <div class='entry-footer'>
  <div class='categories'>
  <span class='taxonomyTerm-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
</span>
  <span class='screen-reader'>Categories: </span><a class='category' href='/categories/tech'>Tech</a></div>
<div class='tags'>
  <span class='taxonomyTerm-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
</span>
  <span class='screen-reader'>Tags: </span><a class='tag' href='/tags/book'>Book</a>, <a class='tag' href='/tags/golang'>Golang</a></div>

  </div>
</footer>


  </article>
  
<nav class='entry-nav-container'>
  <div class='entry-nav'><div class='prev-entry'>
      <a href='/2017/04/05/mysql-partition-table/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader'>Previous post: </span>MySQL partition table</a>
    </div><div class='next-entry'>
      <a href='/2017/04/21/infrastructure-as-code/'>
        <span class='screen-reader'>Next post: </span>Infrastructure as Code<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>

  
</main>

    <footer id='footer' class='footer-container'>
      <div class='footer'>
        <div class='social-menu-container'>
  <nav aria-label='Social Menu'>
    <ul class='social-menu'><li>
        <a href='https://github.com/monsterxx03' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/monsterxx03' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='mailto:xyj.asmy@gmail.com' target='_blank' rel='noopener'>
          <span class='screen-reader'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</div>
        <div class='copyright'>
  <p>
        
      

       &copy; 2017 monsterxx03 
  </p>
</div>

      </div>
    </footer>

  </div><script src='/assets/js/main.f29c93b9.js'></script><script src='/js/custom.js'></script></body>

</html>

